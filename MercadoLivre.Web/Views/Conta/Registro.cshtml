@model MercadoLivre.Web.Models.Usuario
@{
    ViewData["Title"] = "Criar Conta";
}

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow">
                <div class="card-header bg-ml text-center">
                    <h4 class="mb-0 text-dark">
                        <i class="bi bi-person-plus"></i> Criar Conta
                    </h4>
                </div>
                <div class="card-body p-4">
                    @if (ViewBag.Erro != null)
                    {
                        <div class="alert alert-danger" role="alert">
                            <i class="bi bi-exclamation-triangle"></i> @ViewBag.Erro
                        </div>
                    }

                    <form method="post">
                        <div class="mb-3">
                            <label asp-for="Nome" class="form-label">
                                <i class="bi bi-person"></i> Nome Completo
                            </label>
                            <input asp-for="Nome" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Email" class="form-label">
                                <i class="bi bi-envelope"></i> Email
                            </label>
                            <input asp-for="Email" type="email" class="form-control" required>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="Senha" class="form-label">
                                    <i class="bi bi-lock"></i> Senha
                                </label>
                                <input asp-for="Senha" type="password" class="form-control" required minlength="6">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="confirmarSenha" class="form-label">
                                    <i class="bi bi-lock-fill"></i> Confirmar Senha
                                </label>
                                <input type="password" id="confirmarSenha" name="confirmarSenha" class="form-control" required minlength="6">
                            </div>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Telefone" class="form-label">
                                <i class="bi bi-telephone"></i> Telefone
                            </label>
                            <input asp-for="Telefone" type="tel" class="form-control" placeholder="(00) 00000-0000">
                        </div>

                        <h6 class="mt-4 mb-3 text-muted">
                            <i class="bi bi-geo-alt"></i> Endereço (Opcional)
                        </h6>

                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label asp-for="Endereco" class="form-label">Endereço</label>
                                <input asp-for="Endereco" class="form-control" placeholder="Rua, número, complemento">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="CEP" class="form-label">CEP</label>
                                <div class="input-group">
                                    <input asp-for="CEP" class="form-control" placeholder="00000-000" maxlength="9">
                                    <button type="button" class="btn btn-outline-secondary" id="btnBuscarCEP">
                                        <i class="bi bi-search"></i>
                                    </button>
                                </div>
                                <small class="text-muted">Digite o CEP e clique na lupa ou digite 8 dígitos para busca automática</small>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label asp-for="Cidade" class="form-label">Cidade</label>
                                <input asp-for="Cidade" class="form-control">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label asp-for="Estado" class="form-label">Estado</label>
                                <select asp-for="Estado" class="form-select">
                                    <option value="">Selecione</option>
                                    <option value="AC">Acre</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="AP">Amapá</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="BA">Bahia</option>
                                    <option value="CE">Ceará</option>
                                    <option value="DF">Distrito Federal</option>
                                    <option value="ES">Espírito Santo</option>
                                    <option value="GO">Goiás</option>
                                    <option value="MA">Maranhão</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="PA">Pará</option>
                                    <option value="PB">Paraíba</option>
                                    <option value="PR">Paraná</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="PI">Piauí</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="RO">Rondônia</option>
                                    <option value="RR">Roraima</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="SP">São Paulo</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="TO">Tocantins</option>
                                </select>
                            </div>
                        </div>

                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-ml">
                                <i class="bi bi-person-plus"></i> Criar Conta
                            </button>
                        </div>
                    </form>
                </div>
                <div class="card-footer text-center bg-light">
                    <small class="text-muted">
                        Já tem uma conta? 
                        <a asp-action="Login" class="text-decoration-none">
                            <i class="bi bi-box-arrow-in-right"></i> Fazer login
                        </a>
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="text-center mt-4">
    <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">
        <i class="bi bi-arrow-left"></i> Voltar ao Início
    </a>
</div>

<script>
function buscarCEP(cep) {
    if (!cep || cep.length !== 8) {
        alert('Digite um CEP válido com 8 dígitos');
        return;
    }
    
    const btn = document.getElementById('btnBuscarCEP');
    if (btn) {
        btn.disabled = true;
        btn.innerHTML = '<i class="bi bi-hourglass-split"></i>';
    }
    
    document.getElementById('Cidade').value = 'Buscando...';
    document.getElementById('Estado').value = '';
    
    fetch(`https:
        .then(response => response.json())
        .then(data => {
            if (!data.erro) {
                document.getElementById('Cidade').value = data.localidade || '';
                document.getElementById('Estado').value = data.uf || '';
                
                const enderecoField = document.getElementById('Endereco');
                if (!enderecoField.value.trim() && data.logradouro) {
                    enderecoField.value = data.logradouro;
                }
                
                alert('CEP encontrado com sucesso!');
            } else {
                document.getElementById('Cidade').value = '';
                document.getElementById('Estado').value = '';
                alert('CEP não encontrado');
            }
        })
        .catch(error => {
            document.getElementById('Cidade').value = '';
            document.getElementById('Estado').value = '';
            alert('Erro ao buscar CEP. Verifique sua conexão.');
        })
        .finally(() => {
            if (btn) {
                btn.disabled = false;
                btn.innerHTML = '<i class="bi bi-search"></i>';
            }
        });
}

document.addEventListener('DOMContentLoaded', function() {
    const btnBuscar = document.getElementById('btnBuscarCEP');
    if (btnBuscar) {
        btnBuscar.addEventListener('click', function() {
            const cep = document.getElementById('CEP').value.replace(/\D/g, '');
            buscarCEP(cep);
        });
    }
    
    const cepField = document.getElementById('CEP');
    if (cepField) {
        cepField.addEventListener('input', function() {
            let cep = this.value.replace(/\D/g, '');
            
            if (cep.length > 5) {
                cep = cep.replace(/(\d{5})(\d{1,3})/, '$1-$2');
            }
            this.value = cep;
            
            if (cep.replace(/\D/g, '').length === 8) {
                setTimeout(() => buscarCEP(cep.replace(/\D/g, '')), 500);
            }
        });
    }
    
    const telefoneField = document.getElementById('Telefone');
    if (telefoneField) {
        telefoneField.addEventListener('input', function() {
            let telefone = this.value.replace(/\D/g, '');
            
            if (telefone.length >= 2) {
                if (telefone.length <= 6) {
                    telefone = telefone.replace(/(\d{2})(\d{0,4})/, '($1) $2');
                } else if (telefone.length <= 10) {
                    telefone = telefone.replace(/(\d{2})(\d{4})(\d{0,4})/, '($1) $2-$3');
                } else {
                    telefone = telefone.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
                }
            }
            
            this.value = telefone;
        });
    }
});
</script>
