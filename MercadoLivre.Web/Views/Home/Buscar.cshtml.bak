@model IEnumerable<Produto>

@{
    ViewData["Title"] = !string.IsNullOrEmpty(ViewBag.Termo) ? $"Resultados para \"{ViewBag.Termo}\"" : "Buscar produtos";
}

<div class="container my-4">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Início</a></li>
            <li class="breadcrumb-item active">
                @(!string.IsNullOrEmpty(ViewBag.Termo) ? $"Busca: {ViewBag.Termo}" : "Buscar")
            </li>
        </ol>
    </nav>

    <div class="row">
        <!-- Filtros -->
        <div class="col-lg-3 mb-4">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0"><i class="fas fa-filter"></i> Filtros</h6>
                </div>
                <div class="card-body">
                    <!-- Filtro por Categoria -->
                    @if (ViewBag.Categorias != null)
                    {
                        <div class="filter-group mb-4">
                            <h6 class="filter-title">Categoria</h6>
                            <select id="filtro-categoria" class="form-select">
                                <option value="">Todas as categorias</option>
                                @if (ViewBag.Categorias != null)
                                {
                                    @foreach (var categoria in ViewBag.Categorias)
                                    {
                                        <option value="@categoria.Id">@categoria.Nome</option>
                                    }
                                }
                            </select>
                        </div>

                    <!-- Filtro por Preço -->
                    <div class="filter-group mb-4">
                        <h6 class="filter-title">Preço</h6>
                        <select id="filtro-preco" class="form-select">
                            <option value="">Qualquer preço</option>
                            <option value="0-50">Até R$ 50</option>
                            <option value="50-100">R$ 50 a R$ 100</option>
                            <option value="100-250">R$ 100 a R$ 250</option>
                            <option value="250-500">R$ 250 a R$ 500</option>
                            <option value="500-1000">R$ 500 a R$ 1.000</option>
                            <option value="1000-">Mais de R$ 1.000</option>
                        </select>
                    </div>

                    <!-- Filtro por Condição -->
                    <div class="filter-group mb-4">
                        <h6 class="filter-title">Condição</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="condicao-novo">
                            <label class="form-check-label" for="condicao-novo">Novo</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="condicao-usado">
                            <label class="form-check-label" for="condicao-usado">Usado</label>
                        </div>
                    </div>

                    <!-- Filtro por Frete -->
                    <div class="filter-group mb-4">
                        <h6 class="filter-title">Entrega</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="frete-gratis">
                            <label class="form-check-label" for="frete-gratis">Frete grátis</label>
                        </div>
                    </div>

                    <!-- Filtro por Avaliação -->
                    <div class="filter-group">
                        <h6 class="filter-title">Avaliação</h6>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="avaliacao" id="avaliacao-5">
                            <label class="form-check-label" for="avaliacao-5">
                                <span class="rating-stars">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
                                </span>
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="avaliacao" id="avaliacao-4">
                            <label class="form-check-label" for="avaliacao-4">
                                <span class="rating-stars">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i>
                                </span>
                                ou mais
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="avaliacao" id="avaliacao-3">
                            <label class="form-check-label" for="avaliacao-3">
                                <span class="rating-stars">
                                    <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>
                                </span>
                                ou mais
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resultados -->
        <div class="col-lg-9">
            <!-- Header dos Resultados -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    @if (!string.IsNullOrEmpty(ViewBag.Termo))
                    {
                        <h4>Resultados para "<strong>@ViewBag.Termo</strong>"</h4>
                        <p class="text-muted mb-0">
                            @(Model?.Count() ?? 0) produto@(Model?.Count() != 1 ? "s" : "") encontrado@(Model?.Count() != 1 ? "s" : "")
                        </p>
                    }
                    else
                    {
                        <h4>Todos os produtos</h4>
                    }
                </div>
                <div class="d-flex align-items-center">
                    <label class="me-2">Ordenar por:</label>
                    <select class="form-select" style="width: auto;">
                        <option>Mais relevantes</option>
                        <option>Menor preço</option>
                        <option>Maior preço</option>
                        <option>Melhores avaliações</option>
                    </select>
                </div>
            </div>

            @if (Model != null && Model.Any())
            {
                <!-- Grid de Produtos -->
                <div class="row">
                    @foreach (var produto in Model)
                    {
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="card product-card h-100">
                                <div class="position-relative">
                                    @if (produto.PercentualDesconto.HasValue)
                                    {
                                        <span class="badge bg-danger position-absolute top-0 end-0 m-2">
                                            @produto.PercentualDesconto%% OFF
                                        </span>
                                    }
                                    @if (!string.IsNullOrEmpty(produto.ImagemPrincipal))
                                    {
                                        <img src="@produto.ImagemPrincipal" class="card-img-top product-image" alt="@produto.Nome">
                                    }
                                    else
                                    {
                                        <div class="card-img-top product-image bg-light d-flex align-items-center justify-content-center">
                                            <i class="fas fa-image fa-3x text-muted"></i>
                                        </div>
                                    }
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <h6 class="card-title">
                                        <a href="@Url.Action("Detalhes", "Produtos", new { id = produto.Id })" class="product-title">
                                            @produto.Nome
                                        </a>
                                    </h6>
                                    
                                    @if (produto.PrecoOriginal.HasValue)
                                    {
                                        <div class="product-price-original">R$ @produto.PrecoOriginal.Value.ToString("N2")</div>
                                    }
                                    
                                    <div class="product-price">R$ @produto.Preco.ToString("N2")</div>
                                    
                                    @if (produto.PercentualDesconto.HasValue)
                                    {
                                        <div class="product-discount">@produto.PercentualDesconto%% OFF</div>
                                    }
                                    
                                    <div class="product-shipping mt-2">
                                        <i class="fas fa-truck"></i> Frete grátis
                                    </div>
                                    
                                    @if (produto.MediaAvaliacoes > 0)
                                    {
                                        <div class="rating mt-2">
                                            <div class="rating-stars">
                                                @for (int i = 1; i <= 5; i++)
                                                {
                                                    <i class="@(i <= produto.MediaAvaliacoes ? "fas" : "far") fa-star"></i>
                                                }
                                            </div>
                                            <small class="text-muted">(@produto.TotalAvaliacoes)</small>
                                        </div>
                                    }
                                    
                                    <div class="mt-auto pt-3">
                                        <button class="btn btn-ml-primary w-100" 
                                                data-action="add-to-cart" 
                                                data-produto-id="@produto.Id">
                                            <i class="fas fa-cart-plus"></i> Adicionar ao carrinho
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                </div>

                <!-- Paginação -->
                @if (ViewBag.TotalPaginas > 1)
                {
                    <nav aria-label="Navegação da busca">
                        <ul class="pagination justify-content-center">
                            @if (ViewBag.PaginaAtual > 1)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Buscar", new { termo = ViewBag.Termo, categoria = ViewBag.CategoriaId, pagina = ViewBag.PaginaAtual - 1 })">
                                        <i class="fas fa-chevron-left"></i>
                                    </a>
                                </li>
                            }

                            @for (int i = Math.Max(1, ViewBag.PaginaAtual - 2); i <= Math.Min(ViewBag.TotalPaginas, ViewBag.PaginaAtual + 2); i++)
                            {
                                <li class="page-item @(i == ViewBag.PaginaAtual ? "active" : "")">
                                    <a class="page-link" href="@Url.Action("Buscar", new { termo = ViewBag.Termo, categoria = ViewBag.CategoriaId, pagina = i })">
                                        @i
                                    </a>
                                </li>
                            }

                            @if (ViewBag.PaginaAtual < ViewBag.TotalPaginas)
                            {
                                <li class="page-item">
                                    <a class="page-link" href="@Url.Action("Buscar", new { termo = ViewBag.Termo, categoria = ViewBag.CategoriaId, pagina = ViewBag.PaginaAtual + 1 })">
                                        <i class="fas fa-chevron-right"></i>
                                    </a>
                                </li>
                            }
                        </ul>
                    </nav>
                }
            }
            else
            {
                <!-- Nenhum resultado -->
                <div class="text-center py-5">
                    <i class="fas fa-search fa-4x text-muted mb-3"></i>
                    <h4>Nenhum produto encontrado</h4>
                    <p class="text-muted mb-4">
                        @if (!string.IsNullOrEmpty(ViewBag.Termo))
                        {
                            <span>Não encontramos produtos para "<strong>@ViewBag.Termo</strong>"</span>
                        }
                        else
                        {
                            <span>Nenhum produto disponível no momento</span>
                        }
                    </p>
                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <h6>Sugestões:</h6>
                            <ul class="list-unstyled text-start">
                                <li>• Verifique se todas as palavras estão escritas corretamente</li>
                                <li>• Tente palavras-chave diferentes</li>
                                <li>• Tente palavras-chave mais gerais</li>
                                <li>• Tente usar menos palavras-chave</li>
                            </ul>
                            <a asp-controller="Home" asp-action="Index" class="btn btn-ml-primary">
                                <i class="fas fa-home"></i> Voltar ao início
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Aplicar animação aos produtos
            $('.product-card').addClass('fade-in-up');
        });
    </script>
}
